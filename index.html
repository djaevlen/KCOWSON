<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KCOWSON</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
</head>

<body class="p-3">
    <div class="container mb-5">
        <div class="row justify-content-center">
            <div class="col-12 col-md-6 col-lg-4">
                <form action="/" id="generator">
                    <div class="row persons mb-3">
                        <div class="col-6 d-flex align-items-center flex-column">
                            <div class="persons-col-1">

                            </div>
                        </div>
                        <div class="col-6 d-flex align-items-center flex-column">
                            <div class="persons-col-2">

                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-12 text-center">
                            <button type="submit" class="btn btn-primary btn-sm">
                                Dan par
                            </button>
                        </div>
                    </div>
                    <div class="result">

                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <script>


        var persons = [
            {
                id: 0,
                name: 'Klaus',
                image: 'images/klaus.jpeg'
            },
            {
                id: 1,
                name: 'Chriss',
                image: 'images/chriss.jpeg'
            },
            {
                id: 2,
                name: 'Ole A',
                image: 'images/ole_a.jpeg'
            },
            {
                id: 3,
                name: 'Werner',
                image: 'images/werner.jpeg'
            },
            {
                id: 4,
                name: 'SÃ¸ren',
                image: 'images/soren.jpg'
            },
            {
                id: 5,
                name: 'Ole H',
                image: 'images/ole_h.jpeg'
            },
            {
                id: 6,
                name: 'Niller',
                image: 'images/niller.jpeg'
            }
        ];

        function generate_results(checked) {

            // Empty result list
            $('.result').html('');

            shuffle(checked);

            // Check if not even number of persons and then add last person double
            if (!isEven(checked.length)) {
                var last_person = checked[checked.length - 1];
                checked.push(last_person);
            }

            var turn = 1;

            // Insert result into HTML
            checked.forEach(function (id, index) {

                if (!isEven(index)) {
                    return;
                }
                // Insert row with a pair of persons
                $('.result').append(
                    '<div class="row position-relative border border-2 rounded-3 p-3 pb-2 mb-3">' +
                    '<div class="col-4 fw-bold text-center d-flex flex-column align-items-center text-nowrap">' +
                    '<img class="rounded-pill mb-2" src="' + get_person(id).image + '" width="64" height="64" />' +
                    get_person(id).name +
                    '</div>' +
                    '<div class="col-4 small fw-bold text-nowrap text-center pt-4 text-secondary">Par ' + turn + '</div>' +
                    '<div class="col-4 fw-bold text-center d-flex flex-column align-items-center text-nowrap">' +
                    '<img class="rounded-pill mb-2" src="' + get_person(checked[index + 1]).image + '" width="64" height="64" />' +
                    get_person(checked[index + 1]).name +
                    '</div>' +
                    '</div>'
                );
                turn++;
            });

        }



        $(function () {

            // Setup persons checklist
            persons.forEach(function (element) {

                // Determine what column to insert person into
                var selector = '.persons .persons-col-1';
                if (!isEven(element.id)) {
                    var selector = '.persons .persons-col-2';
                }

                // Insert person into column
                $(selector).append(
                    '<div class="d-flex flex-column align-items-start">' +
                    '<div class="form-check">' +
                    '<input class="form-check-input" type="checkbox" value="' + element.id + '" id="' + element.id + '" checked />' +
                    '<label class="form-check-label fw-bold mb-2" for="' + element.id + '">' +
                    element.name +
                    '</label>' +
                    '</div>' +
                    '</div>'
                );
            });

            // Retrive checked persons on form submit
            $('#generator').submit(function (event) {
                event.preventDefault();

                var inputs = event.target.elements;
                var checked = [];
                for (i = 0; i < inputs.length; i++) {
                    if (inputs[i].checked) {
                        checked.push(inputs[i].value);
                    }
                }
                generate_results(checked);
            });


        });

        // Get person from persons array
        function get_person(id) {
            for (var index = 0; index < persons.length; index++) {
                const element = persons[index];
                if (persons[index].id == id) {
                    return persons[index];
                }
            }
        }

        // Shuffle an array
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;

            // While there remain elements to shuffle...
            while (currentIndex != 0) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }

            return array;
        }

        // Check if number is even
        function isEven(n) {
            return n % 2 == 0;
        }


    </script>
</body>

</html>
